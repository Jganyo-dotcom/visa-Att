<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password</title>
    <link rel="stylesheet" href="reset.css" />
  </head>
  <body>
    <div class="reset-container">
      <div class="reset-card">
        <h2>Reset Your Password</h2>
        <p>Please enter a new password below.</p>
        <form id="resetForm">
          <input
            type="password"
            id="newPassword"
            placeholder="New Password"
            required
          />
          <input
            type="password"
            id="confirmPassword"
            placeholder="Confirm Password"
            required
          />
          <button type="submit">Update Password</button>
        </form>
        <div id="resetMessage" class="message"></div>
      </div>
    </div>

    <script>
      // Fetch pending accounts
      //const baseApi = "http://127.0.0.1:4444/";
      const baseApi = "https://attandance-app-1.onrender.com/";
      const resetForm = document.getElementById("resetForm");
      const resetMessage = document.getElementById("resetMessage");

      resetForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const newPassword = document.getElementById("newPassword").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;

        if (newPassword !== confirmPassword) {
          resetMessage.textContent = "Passwords do not match.";
          resetMessage.classList.add("error");
          return;
        }

        // Get token from URL
        const params = new URLSearchParams(window.location.search);
        const token = params.get("token");

        try {
          const response = await fetch(baseApi + "api/reset-password", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ token, newPassword }),
          });

          const result = await response.json();
          resetMessage.textContent = result.message;
          resetMessage.classList.remove("error");
          resetMessage.classList.add("success");
        } catch (err) {
          console.error("Error:", err);
          resetMessage.textContent = "Something went wrong. Please try again.";
          resetMessage.classList.add("error");
        }
      });
    </script>
  </body>
</html>
